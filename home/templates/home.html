{% extends 'base.html' %}

{% block content %}

<div class="container mx-auto">
    <section class="flex flex-col my-14 h-screen ">
        <div class="flex flex-col items-center content-center gap-6 h-5/6 ">
            {% load static %}
            <img src="{% static 'main-match-bg.png' %}" alt="">
            
            {% if home == 1 or home == 2 %}
            <h1 class="text-[#C44B6A] font-bold text-4xl text-center">
                Lengkapi Profilmu, Kisahkan Preferensimu,
                Temukan Pasanganmu!
            </h1>
            {% elif home == 3 %}
            <h1 class="text-[#C44B6A] font-bold text-4xl text-center">
                Siap Untuk Berkisah? Mulailah Match!
            </h1>
            {% endif %}
            
            <div class="flex gap-2">
                {% if home == 1 %}
                <a href="{% url 'authentication:register' %}" ">
                    <button class="w-40 rounded-2xl px-3 py-1 border-2 border-black text-black">Lengkapi Profile</button>
                </a>
                {% load static %}
                <img src="{% static 'arrow.svg' %}" alt="">
                <a href="{% url 'authentication:register' %}" ">
                    <button class="w-40 rounded-2xl px-3 py-1 border-2 border-black text-black">Review Buku</button>
                </a>
                {% load static %}
                <img src="{% static 'arrow.svg' %}" alt="">
                <a href="{% url 'authentication:register' %}" ">
                    <button class="w-40 rounded-2xl px-3 py-1 border-2 border-[#C44B6A] text-[#C44B6A]">Match!</button>
                </a>
                {% elif home == 2 %} 
                {% load static %}
                <img src="{% static 'arrow.svg' %}" alt="">
                <a href="{% url 'authentication:register' %}" ">
                    <button class="w-40 rounded-2xl px-3 py-1 border-2 border-black text-black">Review Buku</button>
                </a>
                {% load static %}
                <img src="{% static 'arrow.svg' %}" alt="">
                <a href="{% url 'authentication:register' %}" ">
                    <button class="w-40 rounded-2xl px-3 py-1 border-2 border-[#C44B6A] text-[#C44B6A]">Match!</button>
                </a>
                {% elif home == 3 %}
                <a href="{% url 'authentication:register' %}" ">
                    <button class="w-40 rounded-2xl px-3 py-1 border-2 border-[#C44B6A] text-[#C44B6A]">Match Sekarang!</button>
                </a>
                {% endif %}
            </div>
        </div>

        <div class="text-center">
            <h1 class="text-4xl">Hi {{ user.username }}!</h1>
            <p class="text-2xl">What's up?</p>
            <div>
                <a class="underline hover:text-blue-600" href="{% url 'authentication:logout' %}">Log Out</a>
            </div>
        </div>
        <br> 
        <input class="w-1/2 p-3 rounded-xl" id="book-search" type="text" placeholder="search your book here..">
        <div id="book-search-result" class="grid grid-cols-4 gap-4 pt-3">
        </div>
    </section>
</div>


<script>
    async function getBooksByQuery(query) {
        let url = "{% url 'books:get_books_by_query' %}?search=" + query;
        console.log(url);
        return fetch("{% url 'books:get_books_by_query' %}?search=" + query)
        .then((res) => res.json())
    }

    async function refreshBooks(query) {
        const books = await getBooksByQuery(query);
        
        let bookList = document.getElementById('book-search-result');
        bookList.innerHTML = "";
        for (let i = 0; i < books.length; i++) {
            if (i >= 20) break; 
            console.log(books[i].title);
            bookList.innerHTML += 
            "<div class='border rounded h-48 p-3 bg-white hover:cursor-pointer hover:shadow-lg'>" 
                + books[i].title 
                + "</div>";
        }
    }
    
    document.getElementById('book-search').addEventListener('keyup', (e) => {    
        const searchString = e.target.value.toLowerCase();
        refreshBooks(searchString); 
    }); 

</script>

{% endblock content %}